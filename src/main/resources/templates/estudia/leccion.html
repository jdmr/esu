<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <title th:text="${'Estudia: '+estudia.publicacion.articulo.titulo +' - ESU'}"></title>
        <meta name="description" content="" th:content="${estudia.publicacion.articulo.descripcion}"/>
        <meta name="author" content="J. David Mendoza"/>
        <link rel="shortcut icon" href="../../static/favicon.ico" th:href="@{/favicon.ico}" />
        <link rel="apple-touch-icon" sizes="57x57" href="../../static/apple-touch-icon-57x57.png" th:href="@{/apple-touch-icon-57x57.png}" />
        <link rel="apple-touch-icon" sizes="114x114" href="../../static/apple-touch-icon-114x114.png" th:href="@{/apple-touch-icon-114x114.png}" />
        <link rel="apple-touch-icon" sizes="72x72" href="../../static/apple-touch-icon-72x72.png" th:href="@{/apple-touch-icon-72x72.png}" />
        <link rel="apple-touch-icon" sizes="144x144" href="../../static/apple-touch-icon-144x144.png" th:href="@{/apple-touch-icon-144x144.png}" />
        <link rel="apple-touch-icon" sizes="60x60" href="../../static/apple-touch-icon-60x60.png" th:href="@{/apple-touch-icon-60x60.png}" />
        <link rel="apple-touch-icon" sizes="120x120" href="../../static/apple-touch-icon-120x120.png" th:href="@{/apple-touch-icon-120x120.png}" />
        <link rel="apple-touch-icon" sizes="76x76" href="../../static/apple-touch-icon-76x76.png" th:href="@{/apple-touch-icon-76x76.png}" />
        <link rel="apple-touch-icon" sizes="152x152" href="../../static/apple-touch-icon-152x152.png" th:href="@{/apple-touch-icon-152x152.png}" />
        <link rel="icon" type="image/png" href="../../static/favicon-196x196.png" sizes="196x196" th:href="@{/favicon-196x196.png}" />
        <link rel="icon" type="image/png" href="../../static/favicon-160x160.png" sizes="160x160" th:href="@{/favicon-160x160.png}" />
        <link rel="icon" type="image/png" href="../../static/favicon-96x96.png" sizes="96x96" th:href="@{/favicon-96x96.png}" />
        <link rel="icon" type="image/png" href="../../static/favicon-16x16.png" sizes="16x16" th:href="@{/favicon-16x16.png}" />
        <link rel="icon" type="image/png" href="../../static/favicon-32x32.png" sizes="32x32" th:href="@{/favicon-32x32.png}" />
        <meta name="msapplication-TileColor" content="#67b6ea" />
        <meta name="msapplication-TileImage" content="../../static/mstile-144x144.png" th:content="@{/mstile-144x144.png}" />
        <meta name="msapplication-config" content="../../static/browserconfig.xml" th:content="@{/browserconfig.xml}" />

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />
        <link rel="stylesheet" href="../../static/styles/main.css" th:href="@{/styles/main.css}" />
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />

    </head>
    <body>

        <header class="navbar navbar-inverse navbar-fixed-top" role="banner" th:replace="layouts/main :: navigation('estudia')">
        </header>

        <div class="container">

            <div class="row" id="searchDiv" th:replace="layouts/main :: searchDiv">

            </div>

            <div class="row leccion">
                <div class="col-md-8">
                    <div class="well versiculo" th:utext="${estudia.versiculo.articulo.contenido}" th:if="${estudia.versiculo != null}">
                        <p>Porque de tal manera amo Dios al mundo...</p>
                    </div>

                    <div class="row" style="padding-top: 20px;">
                        <div class="col-xs-3">
                            <a href="#" th:href="@{'/estudia/'+${ayer.anio}+'/'+${ayer.trimestre}+'/'+${ayer.leccion}+'/'+${ayer.dia}}"><span class="fa fa-chevron-left"></span><span class="hidden-xs"> Anterior</span></a>
                        </div>
                        <div class="col-xs-6 text-center">
                            <a href="#" id="fechaLink" th:text="${estudia.hoyString}">Fecha</a><br/>
                            <a href="#" th:href="@{${estudia.hoyLiga}}" th:unless="${estudia.esHoy}">Lección de Hoy</a>
                            <form id="navegaForm" action="#" th:action="@{/estudia/dia}" method="post">
                                <input type="text" id="fecha" name="fecha" th:value="${#dates.format(estudia.hoy,'dd/MM/yyyy')}" style="display: none;" class='form-control text-center'/>
                            </form>
                        </div>
                        <div class="col-xs-3 text-right">
                            <a href="#" th:href="@{'/estudia/'+${manana.anio}+'/'+${manana.trimestre}+'/'+${manana.leccion}+'/'+${manana.dia}}"><span class="hidden-xs">Siguiente </span><span class="fa fa-chevron-right"></span></a>
                        </div>
                    </div>

                    <h1 class="text-center" th:utext="${estudia.publicacion.articulo.titulo}">Titulo Leccion</h1>
                    <div th:utext="${estudia.publicacion.articulo.contenido}">Texto de la leccion</div>
                    <p><th:block th:text="${estudia.publicacion.articulo.vistas + ' Visitas'}">0 Visitas</th:block> <span class="fa fa-eye"></span></p>

                    <div class="addthis_sharing_toolbox"></div>

                    <div id="disqus_thread"></div>
                    <script type="text/javascript" th:inline="javascript">
                        /*<![CDATA[*/
                        var publicacionId = /*[[${estudia.publicacion.articulo.id}]]*/ 1;
                        var title = /*[[${estudia.publicacion.articulo.titulo}]]*/ 'titulo';

                        /* * * CONFIGURATION VARIABLES * * */
                        var disqus_shortname = 'esuniversitaria';
                        var disqus_identifier = publicacionId;
                        var disqus_title = title;

                        /* * * DON'T EDIT BELOW THIS LINE * * */
                        (function () {
                            var dsq = document.createElement('script');
                            dsq.type = 'text/javascript';
                            dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                        /*]]>*/
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">comments powered by <div class="logo-disqus">Disqus</div></a>
                    <div class="text-center" id="temaDiv">
                        <span class="fa fa-spinner fa-spin"></span>
                    </div>
                </div>
                <div class="col-md-4">
                    <a href="#" th:href="@{${estudia.hoyLiga}}" th:unless="${estudia.esHoy}" class="btn btn-primary btn-lg btn-block btn-cta">Lección de Hoy</a>

                    <th:block th:each="publicacion : ${estudia.articulos}">
                        <th:block th:if="${publicacion.tipo == 'dialoga'}">
                            <h2><a href="#" th:href="@{'/profundiza/'+${publicacion.anio}+'/'+${publicacion.trimestre}+'/'+${publicacion.leccion}+'/'+${publicacion.tema}}" th:utext="${publicacion.articulo.titulo}">Dialoga</a></h2>
                            <h4>Por <th:block th:text="${publicacion.articulo.autor.nombreCompleto}">Autor</th:block></h4>
                            <p><th:block th:utext="${publicacion.articulo.descripcion}">Descripcion</th:block></p>
                            <p><a href="#" th:href="@{'/profundiza/'+${publicacion.anio}+'/'+${publicacion.trimestre}+'/'+${publicacion.leccion}+'/'+${publicacion.tema}}" class="btn btn-primary btn-lg btn-block btn-cta">Leer más...</a></p>
                        </th:block>
                        <th:block th:if="${publicacion.tipo == 'comunica'}">
                            <h2><a href="#" th:href="@{'/comparte/'+${publicacion.anio}+'/'+${publicacion.trimestre}+'/'+${publicacion.leccion}+'/'+${publicacion.tema}}" th:utext="${publicacion.articulo.titulo}">Comunica</a></h2>
                            <h4>Por <th:block th:text="${publicacion.articulo.autor.nombreCompleto}">Autor</th:block></h4>
                            <p><th:block th:utext="${publicacion.articulo.descripcion}">Descripcion</th:block></p>
                            <p><a href="#" th:href="@{'/comparte/'+${publicacion.anio}+'/'+${publicacion.trimestre}+'/'+${publicacion.leccion}+'/'+${publicacion.tema}}" class="btn btn-primary btn-lg btn-block btn-cta">Leer más...</a></p>
                        </th:block>
                        <th:block th:if="${publicacion.tipo == 'leccion'}">
                            <h2><a href="#" th:href="@{'/estudia/'+${publicacion.anio}+'/'+${publicacion.trimestre}+'/'+${publicacion.leccion}+'/'+${publicacion.dia}}" th:utext="${publicacion.articulo.titulo}">Leccion</a></h2>
                            <p><th:block th:utext="${publicacion.articulo.descripcion}">Descripcion</th:block></p>
                            <p><a href="#" th:href="@{'/estudia/'+${publicacion.anio}+'/'+${publicacion.trimestre}+'/'+${publicacion.leccion}+'/'+${publicacion.dia}}" class="btn btn-primary btn-lg btn-block btn-cta">Leer más...</a></p>
                        </th:block>
                    </th:block>

                    <div id="articulosDiv" class="text-center">
                        <span class="fa fa-spinner fa-spin"></span>
                    </div>

                </div>
            </div>

        </div>

        <footer role="contentinfo" th:replace="layouts/main :: footer">
        </footer>

        <div class="modal fade" id="bibliaModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body" >
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <div id="bibliaContenido">
                            <p>One fine body&hellip;</p>
                        </div>
                    </div>
                    <div class="modal-footer leccion">
                        <a href="#" class="btn btn-primary pull-left" id="anteriorBtn">Anterior</a>
                        <a href="#" class="btn btn-primary" id="siguienteBtn">Siguiente</a>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->

        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-19803340-3', 'auto');
            ga('send', 'pageview');

        </script>
        <script type="text/javascript" src="//code.jquery.com/jquery-3.1.0.min.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="https://use.fontawesome.com/dee274d844.js"></script>
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4d8a78014d97ad87" async="async"></script>

        <script th:inline="javascript">
                /*<![CDATA[*/
                "use strict";
                var bibliaUrl = /*[[@{/versiculo}]]*/ '/biblia';
                var date = /*[[${#dates.format(estudia.hoy, 'dd/MM/yyyy')}]]*/ '';
                var popularesUrl = /*[[@{/populares}]]*/ '/populares';
                var profundizaUrl = /*[[@{/profundiza}]]*/ '/profundiza';
                var comparteUrl = /*[[@{/comparte}]]*/ '/comparte';
                var estudiaUrl = /*[[@{/estudia}]]*/ '/estudia';
                var perfilUrl = /*[[@{/perfil}]]*/ '/perfil';
                var estudiaPopularUrl = /*[[@{/estudia/popular}]]*/ '/estudia/popular';
                var posicion = 0;
                var actual = -1;
                var page = 1;
                var actualPage = 0;
                var articulos = [];
                articulos.push(/*[[${estudia.publicacion.articulo.id}]]*/);

                $(function () {
                    $(".leccion").on("click", "a", function (e) {
                        var link = $(this).attr('href');
                        if (link.startsWith("/biblia") || link.startsWith("/versiculo")) {

                            e.preventDefault();

                            $.getJSON(link, function (data) {
                                $("#bibliaContenido").html(data.contenido);
                                if (data.anterior !== null) {
                                    $("#anteriorBtn").show();
                                    $("#anteriorBtn").prop("href", bibliaUrl + data.anterior);
                                } else {
                                    $("#anteriorBtn").hide();
                                }
                                if (data.siguiente !== null) {
                                    $("#siguienteBtn").show();
                                    $("#siguienteBtn").prop("href", bibliaUrl + data.siguiente);
                                } else {
                                    $("#siguienteBtn").hide();
                                }
                                $("#bibliaModal").modal();
                            });
                        }
                    });

                    $("#fechaLink").click(function (e) {
                        e.preventDefault();
                        $(this).hide();
                        $('#fecha').show('slow', function () {
                            $(this).focus();
                        });
                    });

                    $('#fecha').datepicker({
                        altFormat: "dd/mm/yy",
                        dateFormat: "dd/mm/yy",
                        firstDay: 0,
                        closeText: 'Cerrar',
                        prevText: '&#x3c;Ant',
                        nextText: 'Sig&#x3e;',
                        currentText: 'Hoy',
                        monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                        monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                        dayNames: ['Domingo', 'Lunes', 'Martes', 'Mi&eacute;rcoles', 'Jueves', 'Viernes', 'S&aacute;bado'],
                        dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mi&eacute;', 'Jue', 'Vie', 'S&aacute;b'],
                        dayNamesMin: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'S&aacute;'],
                        weekHeader: 'Sm',
                        showButtonPanel: true,
                        showOtherMonths: true,
                        selectOtherMonths: true,
                        minDate: "26/03/2011",
                        defaultDate: date,
                        onSelect: function () {
                            $("form#navegaForm").submit();
                        },
                        onClose: function () {
                            $(this).hide(function () {
                                $('#fechaLink').show();
                            });
                        }
                    });

                });

                function isScrolledIntoView(elem) {
                    var $elem = $(elem);
                    var $window = $(window);

                    var docViewTop = $window.scrollTop();
                    var docViewBottom = docViewTop + $window.height();

                    var elemTop = $elem.offset().top;
                    var elemBottom = elemTop + $elem.height();

                    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
                }

                function contains(a, obj) {
                    for (var i = 0; i < a.length; i++) {
                        if (a[i] === obj) {
                            return true;
                        }
                    }
                    return false;
                }

                $(window).scroll(function () {

                    if (isScrolledIntoView($("div#temaDiv"))) {
                        if (posicion !== actual) {
                            console.log('Buscando popular de estudia(' + posicion + ')');
                            actual = posicion;
                            $.get(estudiaPopularUrl + '/' + posicion, function (data) {
                                if (!contains(articulos, data.publicacion.articulo.id)) {
                                    document.title = 'Estudia: '+data.publicacion.articulo.titulo + ' - ESU';
                                    var html = "<h1>" + data.publicacion.articulo.titulo + "</h1>";
                                    html += "<h3>" + data.diaString + ", " + moment(data.dia).locale("es").format("DD/MM/YYYY") + "</h3>";
                                    html += data.publicacion.articulo.contenido;
                                    html += "<p>" + data.publicacion.articulo.vistas + " Vistas <span class='fa fa-eye'></span></p>";
                                    html += "<hr/>";
                                    $('div#temaDiv').before(html);
                                }
                                posicion = data.posicion;
                            });
                        }
                    }

                    if (isScrolledIntoView($("div#articulosDiv"))) {
                        if (page !== actualPage) {
                            console.log("Getting data(" + page + ")");
                            var div = $('div#articulosDiv');
                            actualPage = page;
                            $.get(popularesUrl, {"page": page}, function (data) {
                                $.each(data, function (i, publicacion) {
                                    if (publicacion.tipo === 'dialoga') {
                                        var html = "<h1><a href='" + profundizaUrl + "/" + publicacion.anio + "/" + publicacion.trimestre + "/" + publicacion.leccion + "/" + publicacion.tema + "'>" + publicacion.articulo.titulo + "</a></h1>";
                                        html += "<h3>Por " + publicacion.articulo.autor.nombreCompleto + "</h3>";
                                        html += "<p>" + publicacion.articulo.descripcion + "</p>";
                                        html += "<p><a href='" + profundizaUrl + "/" + publicacion.anio + "/" + publicacion.trimestre + "/" + publicacion.leccion + "/" + publicacion.tema + "' class='btn btn-primary btn-lg btn-block btn-cta'>Leer m&aacute;s...</a></p>";
                                        div.before(html);
                                    } else if (publicacion.tipo === 'comunica') {
                                        var html = "<h1><a href='" + comparteUrl + "/" + publicacion.anio + "/" + publicacion.trimestre + "/" + publicacion.leccion + "/" + publicacion.tema + "'>" + publicacion.articulo.titulo + "</a></h1>";
                                        html += "<h3>Por " + publicacion.articulo.autor.nombreCompleto + "</h3>";
                                        html += "<p>" + publicacion.articulo.descripcion + "</p>";
                                        html += "<p><a href='" + comparteUrl + "/" + publicacion.anio + "/" + publicacion.trimestre + "/" + publicacion.leccion + "/" + publicacion.tema + "' class='btn btn-primary btn-lg btn-block btn-cta'>Leer m&aacute;s...</a></p>";
                                        div.before(html);
                                    } else if (publicacion.tipo === 'leccion') {
                                        var html = "<h1><a href='" + estudiaUrl + "/" + publicacion.anio + "/" + publicacion.trimestre + "/" + publicacion.leccion + "/" + publicacion.dia + "'>" + publicacion.articulo.titulo + "</a></h1>";
                                        html += "<p>" + publicacion.articulo.descripcion + "</p>";
                                        html += "<p><a href='" + estudiaUrl + "/" + publicacion.anio + "/" + publicacion.trimestre + "/" + publicacion.leccion + "/" + publicacion.dia + "' class='btn btn-primary btn-lg btn-block btn-cta'>Leer m&aacute;s...</a></p>";
                                        div.before(html);
                                    }
                                });
                                page++;
                            });

                        }
                    }

                });
                /*]]>*/
        </script>

    </body>
</html>